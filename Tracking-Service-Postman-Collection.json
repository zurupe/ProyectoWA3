{
	"info": {
		"name": "Tracking Service - Sistema de Seguimiento de Pedidos",
		"description": "Colección completa para el microservicio de seguimiento en tiempo real.\n\n**Endpoints incluidos:**\n- Consulta de estado de pedidos\n- Actualización de tracking\n- Integración con Redis\n- Consistencia eventual\n\n**Variables necesarias:**\n- `base_url`: http://localhost:8084\n- `access_token`: Token JWT del auth-service",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_postman_id": "tracking-service-collection-2024"
	},
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8084",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string"
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{access_token}}",
				"type": "string"
			}
		]
	},
	"item": [
		{
			"name": "📍 Consulta de Tracking",
			"item": [
				{
					"name": "Obtener Estado de Pedido",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/tracking/1",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "1"]
						},
						"description": "Obtener el estado actual de un pedido específico desde Redis."
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response contains tracking state', function () {",
									"    var responseText = pm.response.text();",
									"    pm.expect(responseText).to.be.a('string');",
									"    pm.expect(responseText.length).to.be.greaterThan(0);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "Verificar Pedido Inexistente",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/tracking/99999",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "99999"]
						},
						"description": "Consultar estado de pedido que no existe en Redis."
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Response handles non-existent pedido', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
									"    ",
									"    if (pm.response.code === 200) {",
									"        var responseText = pm.response.text();",
									"        pm.expect(responseText).to.satisfy(function(text) {",
									"            return text === '' || text === 'null' || text.includes('No encontrado');",
									"        });",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				}
			]
		},
		{
			"name": "🔄 Actualización Manual de Tracking",
			"item": [
				{
					"name": "Actualizar Estado a PENDIENTE",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "PENDIENTE"
						},
						"url": {
							"raw": "{{base_url}}/api/tracking/1",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "1"]
						},
						"description": "Actualizar manualmente el estado de tracking a PENDIENTE."
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Estado updated successfully', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "Actualizar Estado a EN_PROCESO",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "EN_PROCESO"
						},
						"url": {
							"raw": "{{base_url}}/api/tracking/1",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "1"]
						},
						"description": "Actualizar manualmente el estado de tracking a EN_PROCESO."
					}
				},
				{
					"name": "Actualizar Estado a ENVIADO",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "ENVIADO"
						},
						"url": {
							"raw": "{{base_url}}/api/tracking/1",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "1"]
						},
						"description": "Actualizar manualmente el estado de tracking a ENVIADO."
					}
				},
				{
					"name": "Actualizar Estado a ENTREGADO",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "ENTREGADO"
						},
						"url": {
							"raw": "{{base_url}}/api/tracking/1",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "1"]
						},
						"description": "Actualizar manualmente el estado de tracking a ENTREGADO."
					}
				}
			]
		},
		{
			"name": "🔗 Consistencia Eventual",
			"item": [
				{
					"name": "Update desde Pedido Service",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"id\": 1,\n    \"estado\": \"EN_PROCESO\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/tracking/update",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "update"]
						},
						"description": "Endpoint utilizado por pedido-service para actualizar tracking automáticamente."
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Consistencia eventual successful', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
									"});",
									"",
									"pm.test('Tracking updated from pedido-service', function () {",
									"    // Verificar que la actualización se procesó correctamente",
									"    pm.expect(pm.response.responseTime).to.be.below(2000);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "Batch Update Multiple Pedidos",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"id\": 2,\n    \"estado\": \"ENVIADO\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/tracking/update",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "update"]
						},
						"description": "Simular actualización de múltiples pedidos para probar consistencia eventual."
					}
				}
			]
		},
		{
			"name": "🧪 Flujos de Prueba",
			"item": [
				{
					"name": "Flujo Completo - Crear Tracking",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "PENDIENTE"
						},
						"url": {
							"raw": "{{base_url}}/api/tracking/123",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "123"]
						},
						"description": "Crear nuevo tracking para pedido 123."
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('New tracking created', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
									"});",
									"",
									"// Guardar pedido ID para siguiente request",
									"pm.collectionVariables.set('test_pedido_id', '123');"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "Flujo Completo - Verificar Tracking Creado",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/tracking/{{test_pedido_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "{{test_pedido_id}}"]
						},
						"description": "Verificar que el tracking fue creado correctamente."
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Tracking exists and has correct state', function () {",
									"    pm.response.to.have.status(200);",
									"    var responseText = pm.response.text();",
									"    pm.expect(responseText).to.include('PENDIENTE');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "Test Performance - Multiple Requests",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/tracking/1",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "1"]
						},
						"description": "Probar performance de consultas a Redis."
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Redis response is fast', function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(100);",
									"});",
									"",
									"pm.test('Cache hit successful', function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				}
			]
		},
		{
			"name": "🧪 Error Cases",
			"item": [
				{
					"name": "Acceso sin Token",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/tracking/1",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "1"]
						},
						"description": "Intentar acceder sin token de autorización."
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Access denied without token', function () {",
									"    pm.response.to.have.status(401);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "Update sin Token",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"id\": 1,\n    \"estado\": \"ENVIADO\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/tracking/update",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "update"]
						},
						"description": "Intentar actualizar tracking sin autenticación."
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Update denied without token', function () {",
									"    pm.response.to.have.status(401);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "Pedido ID Inválido",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/tracking/invalid_id",
							"host": ["{{base_url}}"],
							"path": ["api", "tracking", "invalid_id"]
						},
						"description": "Consultar con ID de pedido inválido."
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Handles invalid pedido ID', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 400, 404]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"console.log('Ejecutando request en Tracking Service...');"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"pm.test('Response time is less than 3000ms', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(3000);",
					"});"
				]
			}
		}
	]
}